/**
 * Created by undershot on 07.11.2016.
 */
!function(a){"function"!=typeof Object.assign&&!function(){Object.assign=function(a){"use strict";if(void 0===a||null===a)throw new TypeError("Cannot convert undefined or null to object");for(var b=Object(a),c=1;c<arguments.length;c++){var d=arguments[c];if(void 0!==d&&null!==d)for(var e in d)d.hasOwnProperty(e)&&(b[e]=d[e])}return b}}();var b=function(a){function c(a){return this._items=a,this._currentItem=null,this._elements={},this}return c.prototype=b.prototype,new c(a)};b.prototype.global={template:"",_randomChars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",_LSName:"boxViewed",_classes:{box:"",boxClose:"",boxLink:"",boxImg:"",boxActive:""},states:{},counter:{boxCloseClicks:0,boxClicks:0,_toCloseBox:1,_boxInterval:60*Math.floor(8)*60},events:{boxClick:function(a){return a.preventDefault(),this.global.counter.boxClicks++,console.log(this._currentItem.href,this.global.counter),!1},_boxHide:function(){var a=this,b=a._elements.box;return b.classList.add("closed"),setTimeout(function(){localStorage.setItem(a.global._LSName,+new Date),document.body.removeChild(b)},200),!1},boxImgLoaded:function(a){var b=this.__getClasses();this._elements.box.classList.add(b.boxActive)},boxCloseClicked:function(a){return a.preventDefault(),this.global.counter.boxCloseClicks==this.global.counter._toCloseBox-1?this.global.events._boxHide.call(this):void this.global.counter.boxCloseClicks++}},renders:{content:{image:function(a){var b=document.createElement("img");return b.setAttribute("src",a.src),b}}}},b.prototype.__randomString=function(a){for(var b="",c=0,d=10,e=62;c++<a;){var f=Math.random()*(e-d)+d<<0;b+=String.fromCharCode(f+=f>9?f<36?55:61:48)}return b},b.prototype.__setClasses=function(){var a=this.global._classes;for(var b in a)a[b]=this.__randomString(10)},b.prototype.__getClasses=function(){return this.global._classes},b.prototype.__renderStyles=function(){this.__setClasses();var a=this.__getClasses(),b="."+a.box+"{\t\tposition: fixed;\t\twidth: 300px;\t\theight: 250px;\t\tright: 0;\t\tbottom: 0;\t\tz-index: 99999;\t\toverflow: hidden;\t\tborder-radius: 3px;\t\tdisplay: block;\t\ttransition: transform .2s cubic-bezier(.42,0,.4,1);\t\ttransform: translate(100%,-5px);\t}\t\t."+a.box+"."+a.boxActive+"{\t    transform: translate(-5px,-5px);\t\tdisplay:block;\t}\t."+a.box+".closed{\t\ttransform: translate(100%,-5px);\t}\t\t."+a.boxImg+"{\t\twidth: 100%;\t\tposition: relative;\t}\t."+a.boxLink+"{\t\tdisplay: block;\t\twidth: 100%;\t\theight: 100%;\t\tposition: absolute;\t\tcursor:pointer;\t\ttop: 0;\t\tleft: 0;\t\tz-index: 1;\t}\t."+a.boxClose+"{\t\tdisplay: block;\t\tposition: absolute;\t\twidth: 25px;\t\theight: 25px;\t\tcursor:pointer;\t\tz-index: 2;\t\ttop: 10px;\t\tleft: 10px;\t\tbackground: #ef4a4a;\t\tline-height: 25px;\t\ttext-align: center;\t\tborder-radius: 40px;\t\ttext-decoration: none;\t\ttransition: background-color .2s;\t}\t."+a.boxClose+":before{\t\tfont: 400 22px/25px sans-serif;\t\tcontent: '\\00d7';\t\tcolor: #fff;\t}\t."+a.boxClose+":hover{\t\tbackground-color: #ff7878;\t}";return b},b.prototype._pasteStyles=function(){var a=document.createElement("style");a.innerHTML=this.__renderStyles(),document.head.appendChild(a)},b.prototype.__setRandomItem=function(){var a=Math.round(Math.random()*(this._items.length-1));this._currentItem=this._items[a]},b.prototype.__renderContent=function(){var a=this._currentItem.type||"image",b=this.global.renders.content;if(!b.hasOwnProperty(a))throw new Error("Undefined type: "+a);return b[a].call(this,this._currentItem)},b.prototype._assignEventElements=function(){var a=this._elements,b=this;return a.boxLink.addEventListener("click",function(a){b.global.events.boxClick.call(b,a)}),a.boxClose.addEventListener("click",function(a){b.global.events.boxCloseClicked.call(b,a)}),a.boxImg.addEventListener("load",function(a){b.global.events.boxImgLoaded.call(b,a)}),this._elements},b.prototype._render=function(){this.__setRandomItem();var a=this.__randomString(3),b=document.createElement(a),c=document.createElement(a),d=this.__renderContent(),e=document.createElement(a),f=this.__getClasses();this._currentItem;return b.setAttribute("class",f.box),c.setAttribute("class",f.boxClose),d.setAttribute("class",f.boxImg),e.setAttribute("class",f.boxLink),e.appendChild(d),b.appendChild(e),b.appendChild(c),Object.assign(this._elements,{box:b,boxImg:d,boxClose:c,boxLink:e}),this._assignEventElements(),b},b.prototype._createNew=function(){return document.body.appendChild(this._render()),this},b.prototype._checkStorage=function(){var a=localStorage.getItem(this.global._LSName);return!a||+new Date-a>=this.global.counter._boxInterval},b.prototype.init=function(){if(this._checkStorage())return this._pasteStyles(),this._createNew(),this},a.Bnr=b}(window);